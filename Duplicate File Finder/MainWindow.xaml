<Window x:Class="DuplicateFinder.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Duplicate File Finder" Height="550" Width="904">
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
    </Window.Resources>
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="10"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Top container -->
        <Grid Grid.Row="0" Margin="0,0,0,10">
            <Image Source="/Properties/MrETools.png"
                   HorizontalAlignment="Left"
                   VerticalAlignment="Top"
                   Stretch="Uniform"
                   MaxHeight="100" />
            <TextBlock HorizontalAlignment="Right"
                       VerticalAlignment="Top"
                       TextAlignment="Right"
                       FontSize="12"
                       Foreground="Gray"><Run Text="Duplicate File Finder"/><LineBreak/><LineBreak/><Run Text="Created By"/><LineBreak/><Run Text="Youtube.com/@MrE-"/><LineBreak/><LineBreak/><Run Text="Version 1.0"/><Run Language="en-gb" Text=".0"/></TextBlock>
        </Grid>

        <!-- Folder Selection -->
        <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,0,0,10">
            <Button Content="Select Folder" Width="120" Click="SelectFolder_Click"/>
            <TextBox x:Name="txtFolderPath" Width="738" Margin="10,0,0,0" IsReadOnly="True"/>
        </StackPanel>

        <!-- Tabs -->
        <TabControl Grid.Row="3">
            <!-- Folders Tab -->
            <TabItem Header="Folders">
                <TreeView x:Name="tvFolders" Margin="5">
                    <TreeView.ItemTemplate>
                        <HierarchicalDataTemplate ItemsSource="{Binding Children}">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="{Binding FolderName}" FontWeight="Bold"/>
                                <TextBlock Text=" (" Foreground="Gray"/>
                                <TextBlock Text="{Binding ExactMatchCount}" Foreground="Green" FontWeight="Bold"/>
                                <TextBlock Text=" Exact, " Foreground="Gray"/>
                                <TextBlock Text="{Binding CloseMatchCount}" Foreground="Orange" FontWeight="Bold"/>
                                <TextBlock Text=" Close)" Foreground="Gray"/>
                            </StackPanel>
                        </HierarchicalDataTemplate>
                    </TreeView.ItemTemplate>
                </TreeView>
            </TabItem>

            <!-- Exact Matches Tab -->
            <TabItem Header="Exact Matches">
                <ListView x:Name="lvExactMatches">
                    <ListView.ContextMenu>
                        <ContextMenu>
                            <MenuItem Header="Open File" Click="ContextMenu_OpenFile_Click"/>
                            <MenuItem Header="Open File Path" Click="ContextMenu_OpenFilePath_Click"/>
                            <Separator/>
                            <MenuItem Header="Delete File" Click="ContextMenu_DeleteFile_Click"/>
                        </ContextMenu>
                    </ListView.ContextMenu>
                    <ListView.View>
                        <GridView>
                            <GridViewColumn Header="File Name" Width="200" DisplayMemberBinding="{Binding FileName}"/>
                            <GridViewColumn Header="Path" Width="400" DisplayMemberBinding="{Binding FilePath}"/>
                            <GridViewColumn Header="Size (KB)" Width="100" DisplayMemberBinding="{Binding SizeKB}"/>
                            <GridViewColumn Header="Created" Width="150" DisplayMemberBinding="{Binding CreatedDate}"/>
                        </GridView>
                    </ListView.View>
                </ListView>
            </TabItem>

            <!-- Close Matches Tab -->
            <TabItem Header="Close Matches">
                <ListView x:Name="lvCloseMatches">
                    <ListView.ContextMenu>
                        <ContextMenu>
                            <MenuItem Header="Open File" Click="ContextMenu_OpenFile_Click"/>
                            <MenuItem Header="Open File Path" Click="ContextMenu_OpenFilePath_Click"/>
                            <Separator/>
                            <MenuItem Header="Delete File" Click="ContextMenu_DeleteFile_Click"/>
                        </ContextMenu>
                    </ListView.ContextMenu>
                    <ListView.View>
                        <GridView>
                            <GridViewColumn Header="File Name" Width="200" DisplayMemberBinding="{Binding FileName}"/>
                            <GridViewColumn Header="Path" Width="400" DisplayMemberBinding="{Binding FilePath}"/>
                            <GridViewColumn Header="Size (KB)" Width="100" DisplayMemberBinding="{Binding SizeKB}"/>
                            <GridViewColumn Header="Created" Width="150" DisplayMemberBinding="{Binding CreatedDate}"/>
                        </GridView>
                    </ListView.View>
                </ListView>
            </TabItem>

            <!-- Results Tab -->
            <TabItem Header="Results">
                <TabItem.Resources>
                    <!-- Define ContextMenu in Resources -->
                    <ContextMenu x:Key="FileItemContextMenu">
                        <MenuItem Header="Open File" Click="ContextMenu_OpenFile_Click"/>
                        <MenuItem Header="Open File Path" Click="ContextMenu_OpenFilePath_Click"/>
                        <Separator/>
                        <MenuItem Header="Delete File" Click="ContextMenu_DeleteFile_Click"/>
                    </ContextMenu>
                </TabItem.Resources>
                <TreeView x:Name="tvResults" Margin="5">
                    <TreeView.ItemContainerStyle>
                        <Style TargetType="TreeViewItem">
                            <Setter Property="IsExpanded" Value="False"/>
                            <Setter Property="FontWeight" Value="Normal"/>
                            <!-- Reference the ContextMenu from Resources -->
                            <Setter Property="ContextMenu" Value="{StaticResource FileItemContextMenu}"/>
                            <Style.Triggers>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="FontWeight" Value="Bold"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </TreeView.ItemContainerStyle>
                    <TreeView.ItemTemplate>
                        <HierarchicalDataTemplate ItemsSource="{Binding DuplicatePaths}">
                            <TextBlock Text="{Binding FileName}" FontWeight="Bold"/>
                            <HierarchicalDataTemplate.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel>
                                        <TextBlock Text="{Binding FilePath}" />
                                        <TextBlock Text="{Binding SizeAndDate}" 
                                       FontSize="10" 
                                       Foreground="Gray" 
                                       Margin="0,2,0,0"/>
                                    </StackPanel>
                                </DataTemplate>
                            </HierarchicalDataTemplate.ItemTemplate>
                        </HierarchicalDataTemplate>
                    </TreeView.ItemTemplate>
                </TreeView>
            </TabItem>
        </TabControl>

        <!-- Enhanced Status Bar -->
        <Grid Grid.Row="4" Margin="0,10,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <TextBlock x:Name="txtStatus"
                       VerticalAlignment="Center"
                       FontStyle="Italic"
                       Foreground="Gray"
                       Padding="5"
                       Text="Awaiting Folder Selection"/>

            <TextBlock x:Name="txtProgress"
                       Grid.Column="1"
                       VerticalAlignment="Center"
                       Margin="10,0"
                       FontStyle="Italic"
                       Foreground="Gray"
                       Visibility="Collapsed"/>

            <ProgressBar x:Name="progressBar"
                         Grid.Column="2"
                         Margin="10,0"
                         Height="20"
                         Visibility="Collapsed"/>

            <Button x:Name="btnStop"
                    Grid.Column="3"
                    Content="Stop"
                    Width="80"
                    Margin="0,0,10,0"
                    Visibility="Collapsed"
                    Click="btnStop_Click"/>

            <Button x:Name="btnCancel"
                    Grid.Column="4"
                    Content="Cancel"
                    Width="80"
                    Visibility="Collapsed"
                    Click="btnCancel_Click"/>
        </Grid>
    </Grid>
</Window>